---
layout: post
title: socat is so cool...
date: '2011-04-22T09:47:00.001-04:00'
author: Scott Cranton
tags: 
modified_time: '2011-04-22T09:48:29.370-04:00'
blogger_id: tag:blogger.com,1999:blog-6291014512017196310.post-1226891206833218585
blogger_orig_url: http://scott.cranton.com/2011/04/socat-is-so-cool.html
comments: false
---

I was helping someone the other day figure out how to use <a href="http://camel.apache.org/">Camel</a> to create a TCP/IP proxy, and I was trying to figure out the best way to test. <a href="http://hiramchirino.com/">Hiram Chirino</a> pointed me at the <a href="http://www.dest-unreach.org/socat/">socat</a> utility, which is so super geeky cool that I am inspired to post about it...<br /><br />I installed socat on my Mac using <a href="http://www.macports.org/">MacPorts</a><br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&gt; sudo ports install socat</span><br /><br />The full code is here on GitHub <a href="https://github.com/scranton/camel-example-tcpipproxy">https://github.com/scranton/camel-example-tcpipproxy</a>.<br /><br />The Camel route is straightforward. It uses <a href="http://camel.apache.org/mina.html">Camel-Mina</a> to both listen on port 5000 and to connect to a request-response (InOut) service on port 5001.<br /><br /><script src="https://gist.github.com/936617.js?file=camelContext.xml"></script> <br /><br />When you run this route, you can use socat as both the back-end service (echo style) and as a client. To start it as a back-end echo service, which will start a TCP/IP listener on port 5001 and will echo all messages sent to it (that's what 'PIPE' does).<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&gt; socat PIPE TCP4-LISTEN:5001<br /><span class="Apple-style-span" style="font-family: Times;"><br /></span></span><br /><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-family: Times;">To use socat as a TCP/IP client, run</span></span><br /><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-family: Times;"><br /></span></span></div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&gt; socat - tcp:localhost:5001</span></div><br />Now any text you type in the Terminal where you started the client will be echo'd back to you - after it goes to and from the socat echo service. You can test this by stopping the socat echo service and seeing how the client reacts.<br /><div><br /></div><div>Back to the Camel proxy... To test, after you start the socat echo server, you'd start the Camel route</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&gt; mvn install camel:run</span></div><div><br /></div><div>This will start the Camel route standalone (the full example can also be deployed within <a href="http://servicemix.apache.org/">ServiceMix</a>), with a TCP/IP listener on port 5000 and a connection to the echo service on port 5001. Now you can start the socat client, but this time against port 5000 (the Camel proxy)</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">&gt; socat - tcp:localhost:5000</span></div><div><br /></div><div>Now your text messages will run through the Camel proxy before going to the back end echo service; the Camel route will log each message that it proxies.</div><div><br /></div><div>A quick example of a cool TCP/IP utility, and how to use the powerful Camel framework to proxy anything... Thanks for the tip Hiram!</div>